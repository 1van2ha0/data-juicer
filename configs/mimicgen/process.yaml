# Isaac Lab annotation configuration for mimicgen
# This configuration runs an annotation task using Isaac Sim.

# --- PREPARATION ---
# 1. Make sure you have a JSONL file at the specified `dataset_path`.
#    Each line should be a JSON object pointing to your HDF5 demo files, e.g.:
#    {"input_file": "path/to/your/demo1.hdf5", "output_file": "path/to/your/annotated_demo1.hdf5"}
#
# 2. The paths in the JSONL file should be absolute or relative to where you run the command.

# --- EXECUTION ---
# Run this configuration with the following command from the root of the data-juicer directory:
# python tools/process_data.py --config configs/mimicgen/test.yaml

# Use absolute path or path relative to the root of the data-juicer project
dataset_path: './demos/mimicgen/process_tasks.jsonl'
export_path: './demos/mimicgen/process_results/'

# Number of parallel processes. For Isaac Sim, it's best to start with 1.
np: 1

executor_type: ray
ray_address: local

process:
  - annotate_demos_mapper:
      # Required: The name of the task in Isaac Lab.
      # This should match the environment the demonstrations were recorded in.
      task_name: 'Isaac-Stack-Cube-Franka-IK-Rel-Visuomotor-Mimic-v0'

      num_proc: 4
      # gpu_required: 0.33
      accelerator: cuda 
      
      # Run Isaac Sim in headless mode (no GUI). Recommended for servers.
      headless: true
      
      # Enable cameras, even in headless mode. This is often required for vision-based tasks.
      enable_cameras: true
      
      # Set to true if your task requires the Pinocchio library for IK controllers.
      enable_pinocchio: false
      
      # --- Advanced Options (usually default is fine) ---
      # Keys in the JSONL file for input and output paths.
      input_file_key: 'input_file'
      output_file_key: 'annotated_file'
      
      # Whether to extract detailed annotation data into the output JSONL.
      extract_annotations: true

  - generate_dataset_mapper:
      # Required task setup
      task_name: 'Isaac-Stack-Cube-Franka-IK-Rel-Visuomotor-Cosmos-Mimic-v0'
      num_envs: 8
      generation_num_trials: 5

      # Device and simulator options
      device: 'cuda:auto'        # auto-bind GPU per actor by rank
      headless: true             # set false if you need rendering windows
      enable_cameras: true

      # IO keys – should match field names in the input JSONL
      input_file_key: 'annotated_file'
      output_file_key: 'output_file'

      # Concurrency – number of Ray actors (disposable) running in parallel
      num_proc: 4
      accelerator: 'cuda' 
